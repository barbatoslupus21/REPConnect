{% load static %}
<link rel="stylesheet" href="{% static 'css/leave/leave.css' %}">

<div class="leave-detail-content">
    <!-- Header Section - Like Job Order Details -->
    <div class="detail-header-section">
        <div class="detail-header-left">
            <span class="detail-control-number">LR-{{ leave_request.control_number }}</span>
            <span class="status-badge status-{{ leave_request.status }}">{{ leave_request.get_status_display }}</span>
        </div>
        <div class="detail-header-right">
            <span class="detail-submitted-date">Submitted: {{ leave_request.date_prepared|date:"M d, Y" }}</span>
        </div>
    </div>

    <!-- Leave Details Section -->
    <div class="detail-section">
        <div class="detail-section-header">
            <h4>Basic Information</h4>
        </div>
        
        <!-- View Mode -->
        <div id="detailViewMode">
            <div class="employee-info-grid">
                <div>
                    <div class="info-label">Requested By:</div>
                    <div class="info-value">
                        <a href="#" class="employee-history-link" data-action="view-leave-history" data-employee-id="{{ leave_request.employee.id }}" data-employee-name="{{ leave_request.employee.firstname }} {{ leave_request.employee.lastname }}">
                            {{ leave_request.employee.firstname }} {{ leave_request.employee.lastname }}
                        </a>
                    </div>
                </div>
                <div>
                    <div class="info-label">Department/Line:</div>
                    <div class="info-value">{{ leave_request.employee.employment_info.department.department_name }}{% if leave_request.employee.employment_info.line.line_name %} ( {{ leave_request.employee.employment_info.line.line_name }} ){% endif %}</div>
                </div>
                <div>
                    <div class="info-label">Date From:</div>
                    <div class="info-value">{{ leave_request.date_from|date:"M d, Y" }}</div>
                </div>
                <div>
                    <div class="info-label">Date To:</div>
                    <div class="info-value">{{ leave_request.date_to|date:"M d, Y" }}</div>
                </div>
                <div>
                    <div class="info-label">Duration:</div>
                    <div class="info-value">{{ leave_request.days_requested|floatformat:0 }} day{% if leave_request.days_requested != 1 %}s{% endif %}, {{ leave_request.hrs_requested|floatformat:0 }} hour{% if leave_request.hrs_requested != 1 %}s{% endif %}</div>
                </div>
                <div>
                    <div class="info-label">Leave Type:</div>
                    <div class="info-value">{{ leave_request.leave_type.name }}</div>
                </div>
                <div>
                    <div class="info-label">Reason Category:</div>
                    <div class="info-value">{{ leave_request.leave_reason.reason_text|default:"N/A" }}</div>
                </div>
                <div class="detail-full-width">
                    <div class="info-label">Reason:</div>
                    <div class="info-value">{{ leave_request.reason }}</div>
                </div>
            </div>
        </div>

    <!-- Approval Status Section - Like Job Order Details -->
    <div class="detail-section">
        <div class="detail-section-header">
            <h4>Approval Status</h4>
        </div>
        
        {% if approval_actions %}
            <div class="approval-timeline">
                {% for action in approval_actions %}
                <div class="approval-timeline-item {% if forloop.last %}last{% endif %}">
                    <div class="approval-timeline-marker status-{{ action.status }}">
                        {% if action.status == 'approved' %}
                            <i class="fa fa-check-circle"></i>
                        {% elif action.status == 'disapprove' %}
                            <i class="fa fa-times-circle"></i>
                        {% elif action.status == 'routing' %}
                            <i class="fas fa-clock"></i>
                        {% elif action.status == 'cancelled' %}
                            <i class="fa fa-exclamation-circle"></i>
                        {% else %}
                            <i class="fa fa-check-circle"></i>
                        {% endif %}
                    </div>
                    <div class="approval-timeline-content">
                        <div class="approval-timeline-title">
                            {{ action.approver.firstname }}, {{ action.approver.lastname }} - 
                            {% if action.status == 'approved' %}
                                Approved
                            {% elif action.status == 'disapprove' %}
                                Disapproved
                            {% elif action.status == 'routing' %}
                                Pending Approval
                            {% elif action.status == 'cancelled' %}
                                Cancelled
                            {% else %}
                                Submitted
                            {% endif %}
                        </div>
                        <div class="approval-timeline-subtitle">
                            {% if action.status == 'routing' %}
                                Waiting for {{ action.approver.firstname }}, {{ action.approver.lastname }}'s approval
                            {% else %}
                                {% if action.action == 'submitted' %}
                                    Submitted by {{ action.approver.firstname }}, {{ action.approver.lastname }} on {{ action.action_at|date:"M d, Y" }}, {{ action.action_at|date:"g:i A" }}
                                {% else %}
                                    {{ action.get_status_display }} by {{ action.approver.firstname }}, {{ action.approver.lastname }} on {{ action.action_at|date:"M d, Y" }}, {{ action.action_at|date:"g:i A" }}
                                {% endif %}
                            {% endif %}
                        </div>
                        {% if action.comments and action.comments != 'Updated my leave request' %}
                            <div class="approval-timeline-comments">"{{ action.comments }}"</div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-history"></i>
                <p>No approval status available.</p>
            </div>
        {% endif %}
    </div>
</div>