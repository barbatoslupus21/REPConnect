{% extends "main.html" %}
{% load static %}

{% block title %}REPConnect - Finance{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/finance/finance.css' %}">
    <link rel="stylesheet" href="{% static 'css/finance/user.css' %}">
{% endblock %}

{% block content %}
<div class="page-content" id="page-content">
    <!-- Modern Header -->
    <header class="page-header">
        <div class="page-header-content">
            <h2>My Finance</h2>
            <p>Track your payslips, allowances, savings, and loans</p>
        </div>
    </header>

    {% if request.user.employment_info.employment_type != 'OJT' %}
    <!-- Modern Stats Cards -->
    <div class="finance-stats-section" data-tour="dashboard-stats" data-intro="<b>Dashboard Statistics</b><br>View your financial overview at a glance." data-step="1">
        <div class="finance-stat-card payslips">
            <div class="stat-card-icon">
                <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <div class="stat-card-content">
                <span class="stat-card-value">{{ total_payslips }}</span>
                <span class="stat-card-label">Payslips</span>
            </div>
            <div class="stat-card-decoration"></div>
        </div>
        
        <div class="finance-stat-card allowances">
            <div class="stat-card-icon">
                <i class="fas fa-gift"></i>
            </div>
            <div class="stat-card-content">
                <span class="stat-card-value privacy-blur clickable-privacy" data-value="₱{{ total_allowances|floatformat:2 }}" onclick="toggleValuePrivacy(this)">
                    ₱ ****
                </span>
                <span class="stat-card-label">Allowances Balance</span>
            </div>
            <div class="stat-card-decoration"></div>
        </div>
        
        <div class="finance-stat-card savings">
            <div class="stat-card-icon">
                <i class="fas fa-piggy-bank"></i>
            </div>
            <div class="stat-card-content">
                <span class="stat-card-value privacy-blur clickable-privacy" data-value="₱{{ total_savings|floatformat:2 }}" onclick="toggleValuePrivacy(this)">
                    ₱ ****
                </span>
                <span class="stat-card-label">Total Savings</span>
            </div>
            <div class="stat-card-decoration"></div>
        </div>
        
        <div class="finance-stat-card loans">
            <div class="stat-card-icon">
                <i class="fas fa-hand-holding-usd"></i>
            </div>
            <div class="stat-card-content">
                <span class="stat-card-value privacy-blur clickable-privacy" data-value="₱{{ total_loans|floatformat:2 }}" onclick="toggleValuePrivacy(this)">
                    ₱ ****
                </span>
                <span class="stat-card-label">Active Loans</span>
            </div>
            <div class="stat-card-decoration"></div>
        </div>
    </div>
    {% endif %}

    <!-- Main Content Grid -->
    <div class="finance-main-grid">
        <!-- Top Row - Payslips, Allowances & Savings -->
        <div class="finance-top-row">
            <!-- Payslips Section -->
            <div class="finance-card payslip-card" data-tour="payslips-section" data-intro="<b>Payslips</b><br>Access and manage all your payslips here." data-step="2">
                <div class="finance-card-header">
                    <div class="card-header-left">
                        <div class="card-header-icon payslip">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <div class="card-header-text">
                            <h3>Payslips</h3>
                            <span>Your salary statements</span>
                        </div>
                    </div>
                </div>
                <div class="finance-card-body">
                    {% if request.user.employment_info.employment_type != 'OJT' %}
                        {% if payslips %}
                            <div class="payslip-list">
                                {% for payslip in payslips %}
                                <div class="payslip-item">
                                    <div class="payslip-item-left">
                                        <div class="payslip-icon">
                                            <i class="fas fa-file-pdf"></i>
                                        </div>
                                        <div class="payslip-info">
                                            <span class="payslip-date">{{ payslip.cutoff_date|date:"F j, Y" }}</span>
                                            <span class="payslip-filename">{{ payslip.file_path.name|truncatechars:30 }}</span>
                                        </div>
                                    </div>
                                    <div class="payslip-item-right">
                                        {% if payslip.is_send_to_mail %}
                                            <span class="payslip-status sent">
                                                <i class="fas fa-check-circle"></i> Sent
                                            </span>
                                        {% else %}
                                            <span class="payslip-status pending">
                                                <i class="fas fa-clock"></i> Pending
                                            </span>
                                        {% endif %}
                                        <button type="button" class="payslip-action-btn send-payslip-email-btn"
                                            data-payslip-id="{{ payslip.id }}"
                                            data-employee-id="{{ payslip.employee.id }}"
                                            data-cutoff-date="{{ payslip.cutoff_date }}"
                                            data-user-email="{{ request.user.email }}"
                                            data-work-email="{{ request.user.personal_info.work_email }}"
                                            title="Send to Email">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state-modern">
                                <div class="empty-icon-wrapper">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <h4>No Payslips Yet</h4>
                                <p>Your payslips will appear here once uploaded</p>
                            </div>
                        {% endif %}
                    {% else %}
                        <!-- OJT Payslips -->
                        {% if ojtpayslips %}
                            <div class="payslip-list">
                                {% for payslip in ojtpayslips %}
                                <div class="payslip-item ojt">
                                    <div class="payslip-item-left">
                                        <div class="payslip-icon ojt">
                                            <i class="fas fa-user-graduate"></i>
                                        </div>
                                        <div class="payslip-info">
                                            <span class="payslip-date">{{ payslip.cut_off }}</span>
                                            <span class="payslip-amount">Net Share: ₱{{ payslip.net_ojt_share|floatformat:2 }}</span>
                                        </div>
                                    </div>
                                    <div class="payslip-item-right">
                                        <span class="payslip-total">₱{{ payslip.total_allowance|floatformat:2 }}</span>
                                        <button type="button" class="payslip-action-btn view-ojtpayslip-btn"
                                            data-payslip-id="{{ payslip.id }}"
                                            data-employee-id="{{ payslip.employee.id }}"
                                            data-cutoff-date="{{ payslip.cut_off }}"
                                            title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="payslip-action-btn send-ojtpayslip-email-btn"
                                            data-payslip-id="{{ payslip.id }}"
                                            data-employee-id="{{ payslip.employee.id }}"
                                            data-cutoff-date="{{ payslip.cut_off }}"
                                            data-user-email="{{ request.user.email }}"
                                            title="Send to Email">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state-modern">
                                <div class="empty-icon-wrapper">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <h4>No Payslips Yet</h4>
                                <p>Your OJT payslips will appear here</p>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Allowances Section -->
            {% if request.user.employment_info.employment_type != 'OJT' %}
            <div class="finance-card allowance-card" data-tour="allowances-section" data-intro="<b>Allowances</b><br>View your allowances and benefits." data-step="4">
                <div class="finance-card-header">
                    <div class="card-header-left">
                        <div class="card-header-icon allowance">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="card-header-text">
                            <h3>Allowances</h3>
                            <span>Benefits & Compensation</span>
                        </div>
                    </div>
                </div>
                <div class="finance-card-body">
                    {% if allowances %}
                        <div class="savings-list">
                            {% for allowance in allowances %}
                            <div class="savings-item {% if not allowance.deposit_date %}active{% else %}withdrawn{% endif %}">
                                <div class="savings-item-left">
                                    <div class="savings-info">
                                        <span class="savings-type">{{ allowance.allowance_type }}</span>
                                        <span class="savings-meta">
                                            {% if allowance.deposit_date %}
                                                Deposited {{ allowance.deposit_date|date:"M j, Y" }}
                                            {% elif allowance.period_covered %}
                                                {{ allowance.period_covered }}
                                            {% else %}
                                                Current Balance
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="savings-item-right">
                                    <span class="savings-status {% if not allowance.deposit_date %}active{% else %}withdrawn{% endif %}">
                                        {% if allowance.deposit_date %}
                                            <i class="fas fa-arrow-up"></i> Deposited
                                        {% else %}
                                            <i class="fas fa-check-circle"></i> Active
                                        {% endif %}
                                    </span>
                                    <span class="savings-amount {% if allowance.deposit_date %}withdrawn{% endif %}">₱{{ allowance.amount|floatformat:2 }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                    {% else %}
                        <div class="empty-state-centered">
                            <div class="empty-icon-wrapper">
                                <i class="fas fa-gift"></i>
                            </div>
                            <h4>No Allowances</h4>
                            <p>Your allowances will appear here</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Savings Section -->
            {% if request.user.employment_info.employment_type != 'OJT' %}
            <div class="finance-card savings-card" data-tour="savings-section" data-intro="<b>Savings</b><br>Track your savings and growth." data-step="5">
                <div class="finance-card-header">
                    <div class="card-header-left">
                        <div class="card-header-icon savings">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                        <div class="card-header-text">
                            <h3>Savings</h3>
                            <span>Your financial growth</span>
                        </div>
                    </div>
                </div>
                <div class="finance-card-body">
                    {% if savings %}
                        <div class="savings-list">
                            {% for saving in savings %}
                            <div class="savings-item {% if saving.is_withdrawn %}withdrawn{% else %}active{% endif %}">
                                <div class="savings-item-left">
                                    <div class="savings-info">
                                        <span class="savings-type">
                                            {% if saving.savings_type %}{{ saving.savings_type.savings_type }}{% else %}Personal Savings{% endif %}
                                        </span>
                                        <span class="savings-meta">
                                            {% if saving.is_withdrawn %}
                                                Withdrawn {{ saving.withdrawal_date|date:"M j, Y" }}
                                            {% else %}
                                                Started {{ saving.created_at|date:"M j, Y" }}
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="savings-item-right">
                                    <span class="savings-status {% if saving.is_withdrawn %}withdrawn{% else %}active{% endif %}">
                                        {% if saving.is_withdrawn %}
                                            <i class="fas fa-arrow-up"></i> Withdrawn
                                        {% else %}
                                            <i class="fas fa-check-circle"></i> Active
                                        {% endif %}
                                    </span>
                                    <span class="savings-amount {% if saving.is_withdrawn %}withdrawn{% endif %}">₱{{ saving.amount|floatformat:2 }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-state-centered">
                            <div class="empty-icon-wrapper">
                                <i class="fas fa-piggy-bank"></i>
                            </div>
                            <h4>No Savings</h4>
                            <p>Start saving to see your progress</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Bottom Row - Loans Section -->
        {% if request.user.employment_info.employment_type != 'OJT' and loans %}
        <div class="finance-bottom-row">
            <div class="finance-card loans-card" data-tour="loans-section" data-intro="<b>Loans</b><br>Track your loan balances and payment progress." data-step="3">
                <div class="finance-card-header">
                    <div class="card-header-left">
                        <div class="card-header-icon loan">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <div class="card-header-text">
                            <h3>Loans</h3>
                            <span>as of {{ now|date:'M d, Y' }}</span>
                        </div>
                    </div>
                    <div class="card-header-right">
                        <label class="toggle-switch-modern">
                            <input type="checkbox" id="showActiveLoansOnly" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Active Only</span>
                        </label>
                    </div>
                </div>
                <div class="finance-card-body loans-body">
                    <div class="loans-grid">
                        {% for loan in loans %}
                        <div class="loan-card-modern {% if loan.current_balance|floatformat:2 == '0.00' %}inactive{% endif %}" 
                             data-active="{{ loan.is_active|yesno:'true,false' }}"
                             data-balance="{{ loan.current_balance|floatformat:2 }}"
                             style="{% if loan.current_balance|floatformat:2 == '0.00' %}display:none;{% endif %}">
                            <div class="loan-card-header">
                                <div class="loan-type-badge">
                                    <i class="fas fa-university"></i>
                                    {{ loan.loan_type.loan_type }}
                                </div>
                                <span class="loan-status {% if loan.current_balance|floatformat:2 == '0.00' %}paid{% else %}active{% endif %}">
                                    {% if loan.current_balance|floatformat:2 == '0.00' %}
                                        <i class="fas fa-check"></i> Paid
                                    {% else %}
                                        <i class="fas fa-sync-alt"></i> Active
                                    {% endif %}
                                </span>
                            </div>
                            <div class="loan-card-body">
                                <div class="loan-amount-display">
                                    <span class="loan-balance-label">Balance</span>
                                    <span class="loan-balance-value">₱{{ loan.current_balance|floatformat:2 }}</span>
                                </div>
                                <div class="loan-progress-modern">
                                    <div class="progress-bar-modern">
                                        <div class="progress-fill" style="width: {{ loan.percent_paid|floatformat:0 }}%"></div>
                                    </div>
                                    <div class="progress-info">
                                        <span>{{ loan.percent_paid|floatformat:0 }}% paid</span>
                                        <span>₱{{ loan.paid|floatformat:2 }} / ₱{{ loan.principal_amount|floatformat:2 }}</span>
                                    </div>
                                </div>
                                <div class="loan-details-row">
                                    <div class="loan-detail">
                                        <span class="detail-label">Monthly</span>
                                        <span class="detail-value">₱{{ loan.monthly_deduction|floatformat:2 }}</span>
                                    </div>
                                    <div class="loan-detail">
                                        <span class="detail-label">Started</span>
                                        <span class="detail-value">{{ loan.created_at|date:"M Y" }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="loan-card-footer">
                                <button class="loan-view-btn view-loan-btn" data-loan-id="{{ loan.id }}" title="View Details">
                                    <i class="fas fa-eye"></i>
                                    View History
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Email Selection Modal -->
<div id="emailSelectionModal" class="modal modal-sm">
    <div class="modal-overlay"></div>
    <div class="modal-content modern-modal">
        <div class="modal-header">
            <h3><i class="fas fa-envelope"></i> Send Payslip</h3>
            <button class="modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="email-selection-form">
                <form id="email-selection-form">
                    {% csrf_token %}
                    <p class="modal-subtitle">Choose where to send your payslip:</p>
                    <div class="email-selection-options" id="email-options">
                        {% if request.user.email %}
                        <div class="email-option-card">
                            <input type="radio" name="selected_email" value="{{ request.user.email }}" id="account-email" checked>
                            <label for="account-email" class="email-option-label">
                                <div class="email-option-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="email-option-info">
                                    <div class="email-option-name">{{ request.user.email }}</div>
                                    <div class="email-option-username">Personal Email</div>
                                </div>
                                <div class="email-option-check">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </label>
                        </div>
                        {% endif %}
                        {% if request.user.personal_info.work_email and request.user.personal_info.work_email != request.user.email %}
                        <div class="email-option-card">
                            <input type="radio" name="selected_email" value="{{ request.user.personal_info.work_email }}" id="work-email">
                            <label for="work-email" class="email-option-label">
                                <div class="email-option-avatar work">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <div class="email-option-info">
                                    <div class="email-option-name">{{ request.user.personal_info.work_email }}</div>
                                    <div class="email-option-username">Work Email</div>
                                </div>
                                <div class="email-option-check">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </label>
                        </div>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-close">Cancel</button>
            <button class="btn btn-primary" id="confirm-email-send">
                <i class="fas fa-paper-plane"></i>
                Send
            </button>
        </div>
    </div>
</div>

<!-- OJT Email Confirmation Modal -->
<div id="ojtEmailConfirmationModal" class="modal modal-md">
    <div class="modal-overlay"></div>
    <div class="modal-content modern-modal">
        <div class="modal-header">
            <h4><i class="fas fa-envelope"></i> Send OJT Payslip</h4>
            <button class="modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="confirmation-message">
                <p>Send your OJT payslip to:</p>
                <div class="email-display-modern">
                    <i class="fas fa-at"></i>
                    <span id="ojt-confirmation-email">{{ request.user.email }}</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-close">Cancel</button>
            <button class="btn btn-primary" id="confirm-ojt-email-send">
                <i class="fas fa-paper-plane"></i>
                Send
            </button>
        </div>
    </div>
</div>

<!-- Email Loader -->
<div class="loader-container" id="emailLoader" style="display: none;">
    <div class="modern-loader">
        <div class="loader-spinner"></div>
        <p>Sending Payslip...</p>
    </div>
</div>

<!-- OJT Payslip Details Modal -->
<div id="ojtPayslipDetailsModal" class="modal modal-lg">
    <div class="modal-overlay"></div>
    <div class="modal-content modern-modal">
        <div class="modal-header">
            <h3><i class="fas fa-file-alt"></i> OJT Payslip Details</h3>
            <button class="modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="ojtPayslipDetailsBody">
            <div class="payslip-container">
                <div class="payslip-header">
                    <div class="company-info">
                        <img src="{% static 'images/icon/ryonanlogo.png' %}" alt="Ryonan Logo" class="company-logo">
                        <div class="company-details">
                            <h1>RYONAN ELECTRIC PHILIPPINES CORPORATION</h1>
                            <p>105 East Main Avenue, Special Export Processing Zone<br>
                            Laguna, Technopark, Biñan, Laguna</p>
                        </div>
                    </div>
                </div>
                
                <div class="payslip-content">
                    <div class="employee-info-grid">
                        <div>
                            <div class="info-label">ID Number:</div>
                            <div class="info-value" id="ojt-id-number">-</div>
                        </div>
                        <div>
                            <div class="info-label">Cut-Off:</div>
                            <div class="info-value" id="ojt-cutoff">-</div>
                        </div>
                        <div>
                            <div class="info-label">Name:</div>
                            <div class="info-value" id="ojt-name">-</div>
                        </div>
                        <div>
                            <div class="info-label">Line:</div>
                            <div class="info-value" id="ojt-line">-</div>
                        </div>
                    </div>

                    <div class="payslip-sections">
                        <div class="section-row">
                            <div class="section regular-day">
                                <h3>Regular Day</h3>
                                <div class="section-content">
                                    <div class="field">
                                        <span class="field-label">REGULAR # of Days Work</span>
                                        <span class="field-value" id="ojt-regular-days">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">ALLOWANCE/DAY</span>
                                        <span class="field-value" id="ojt-allowance-day">-</span>
                                    </div>
                                    <div class="field total">
                                        <span class="field-label">Total:</span>
                                        <span class="field-value" id="ojt-regular-total">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">REG ND ALLOWANCE</span>
                                        <span class="field-value" id="ojt-reg-nd-allowance">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">GRAND TOTAL</span>
                                        <span class="field-value" id="ojt-grand-total">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">BASIC ALLOW.SCHOOL SHARE</span>
                                        <span class="field-value" id="ojt-basic-school-share">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">BASIC ALLOW. OJT SHARE</span>
                                        <span class="field-value" id="ojt-basic-ojt-share">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">DEDUCTION</span>
                                        <span class="field-value" id="ojt-deduction">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">NET BASIC ALLOW. OJT SHARE</span>
                                        <span class="field-value" id="ojt-net-basic-share">-</span>
                                    </div>
                                </div>
                            </div>

                            <div class="section allowances">
                                <h3>Allowances</h3>
                                <div class="section-content">
                                    <div class="field">
                                        <span class="field-label">RICE ALLOWANCE</span>
                                        <span class="field-value" id="ojt-rice-allowance">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">Reg OT ALLOWANCE</span>
                                        <span class="field-value" id="ojt-reg-ot-allowance">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">REG ND OT ALLOWANCE</span>
                                        <span class="field-value" id="ojt-reg-nd-ot-allowance">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">SPECIAL HOLIDAY</span>
                                        <span class="field-value" id="ojt-special-holiday">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">LEGAL HOLIDAY</span>
                                        <span class="field-value" id="ojt-legal-holiday">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">SAT-OFF ALLOWANCE</span>
                                        <span class="field-value" id="ojt-sat-off-allowance">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">RD OT</span>
                                        <span class="field-value" id="ojt-rd-ot">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">PERFECT ATTENDANCE</span>
                                        <span class="field-value" id="ojt-perfect-attendance">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">ADJUSTMENT</span>
                                        <span class="field-value" id="ojt-adjustment">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">DEDUCTION 2</span>
                                        <span class="field-value" id="ojt-deduction-2">-</span>
                                    </div>
                                    <div class="field">
                                        <span class="field-label">NET OJT OT PAY ALLOWANCE</span>
                                        <span class="field-value" id="ojt-net-ot-pay-allowance">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="total-allowance">
                            <h2>TOTAL ALLOWANCE: <span id="ojt-total-allowance-display">-</span></h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-close">Close</button>
        </div>
    </div>
</div>

<!-- Loan Deductions Modal -->
<div id="loanDeductionsModal" class="modal modal-md">
    <div class="modal-overlay"></div>
    <div class="modal-content modern-modal">
        <div class="modal-header">
            <h3><i class="fas fa-history"></i> Loan History</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="loanDeductionsBody">
            <div class="loader" style="text-align:center; padding:2em;">
                <div class="loader-spinner"></div>
                <p>Loading...</p>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toast-container" class="toast-container"></div>

{% endblock content %}

{% block extra_js %}
<script>
// Privacy toggle for stat card values - click to show/hide
function toggleValuePrivacy(el) {
    if (el.classList.contains('privacy-blur')) {
        el.textContent = el.dataset.value;
        el.classList.remove('privacy-blur');
    } else {
        el.textContent = '₱ ****';
        el.classList.add('privacy-blur');
    }
}

// Active loans toggle
document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('showActiveLoansOnly');
    if (toggle) {
        toggle.addEventListener('change', function() {
            const loanCards = document.querySelectorAll('.loan-card-modern');
            loanCards.forEach(card => {
                const balance = parseFloat(card.dataset.balance);
                if (this.checked) {
                    card.style.display = balance > 0 ? '' : 'none';
                } else {
                    card.style.display = '';
                }
            });
        });
    }

});
</script>
<script src="{% static 'js/finance/user-finance.js' %}"></script>
{% endblock %}
